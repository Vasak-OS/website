{{/* 
  Partial: mermaid-content
  
  Procesa el contenido para asegurar que los bloques mermaid se rendericen correctamente.
  A침ade la clase 'mermaid' autom치ticamente a los bloques de c칩digo con lenguaje 'mermaid'
*/}}

<!-- Mermaid diagram initialization script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Inicializar Mermaid
  if (typeof mermaid !== 'undefined') {
    mermaid.initialize({ 
      startOnLoad: true, 
      theme: 'default', 
      securityLevel: 'loose',
      flowchart: {
        useMaxWidth: true,
        htmlLabels: true,
        curve: 'cardinal'
      },
      sequenceDiagram: {
        useMaxWidth: true,
        diagramMarginX: 50,
        diagramMarginY: 10
      },
      blockDiagram: {
        useMaxWidth: true
      }
    });
    
    // Procesar diagrama mermaid en bloques de c칩digo
    const codeTags = document.querySelectorAll('pre > code.language-mermaid');
    codeTags.forEach(function(tag) {
      const preTag = tag.parentElement;
      const mermaidContent = tag.textContent;
      
      // Crear un nuevo div con clase mermaid
      const mermaidDiv = document.createElement('div');
      mermaidDiv.className = 'mermaid';
      mermaidDiv.textContent = mermaidContent;
      
      // Reemplazar el pre con el div
      preTag.parentNode.replaceChild(mermaidDiv, preTag);
    });
    
    // Renderizar diagramas
    mermaid.contentLoaded();
  }
  
  // Soporte para modo oscuro
  const htmlElement = document.documentElement;
  const observerOptions = {
    attributes: true,
    attributeFilter: ['class']
  };
  
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.attributeName === 'class') {
        const isDark = htmlElement.classList.contains('dark');
        const theme = isDark ? 'dark' : 'default';
        
        if (typeof mermaid !== 'undefined') {
          mermaid.initialize({ 
            startOnLoad: true, 
            theme: theme, 
            securityLevel: 'loose'
          });
          mermaid.contentLoaded();
        }
      }
    });
  });
  
  observer.observe(htmlElement, observerOptions);
});
</script>
